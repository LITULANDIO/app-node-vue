{"version":3,"file":"index.d8e9ef50.js","sources":["../../../../node_modules/@unhead/ssr/dist/index.mjs"],"sourcesContent":["import { TagsWithInnerContent, SelfClosingTags, computeHashes } from '@unhead/shared';\n\nfunction propsToString(props) {\n  const handledAttributes = [];\n  for (const [key, value] of Object.entries(props)) {\n    if (value === false || value == null)\n      continue;\n    let attribute = key;\n    if (value !== true)\n      attribute += `=\"${String(value).replace(/\"/g, \"&quot;\")}\"`;\n    handledAttributes.push(attribute);\n  }\n  return handledAttributes.length > 0 ? ` ${handledAttributes.join(\" \")}` : \"\";\n}\n\nfunction encodeInnerHtml(str) {\n  return str.replace(/[&<>\"'/]/g, (char) => {\n    switch (char) {\n      case \"&\":\n        return \"&amp;\";\n      case \"<\":\n        return \"&lt;\";\n      case \">\":\n        return \"&gt;\";\n      case '\"':\n        return \"&quot;\";\n      case \"'\":\n        return \"&#x27;\";\n      case \"/\":\n        return \"&#x2F;\";\n      default:\n        return char;\n    }\n  });\n}\nfunction tagToString(tag) {\n  const attrs = propsToString(tag.props);\n  const openTag = `<${tag.tag}${attrs}>`;\n  if (!TagsWithInnerContent.includes(tag.tag))\n    return SelfClosingTags.includes(tag.tag) ? openTag : `${openTag}</${tag.tag}>`;\n  let content = String(tag.innerHTML || \"\");\n  if (tag.textContent)\n    content = encodeInnerHtml(String(tag.textContent));\n  return SelfClosingTags.includes(tag.tag) ? openTag : `${openTag}${content}</${tag.tag}>`;\n}\n\nfunction ssrRenderTags(tags) {\n  const schema = { htmlAttrs: {}, bodyAttrs: {}, tags: { head: [], bodyClose: [], bodyOpen: [] } };\n  for (const tag of tags) {\n    if (tag.tag === \"htmlAttrs\" || tag.tag === \"bodyAttrs\") {\n      schema[tag.tag] = { ...schema[tag.tag], ...tag.props };\n      continue;\n    }\n    schema.tags[tag.tagPosition || \"head\"].push(tagToString(tag));\n  }\n  return {\n    headTags: schema.tags.head.join(\"\\n\"),\n    bodyTags: schema.tags.bodyClose.join(\"\\n\"),\n    bodyTagsOpen: schema.tags.bodyOpen.join(\"\\n\"),\n    htmlAttrs: propsToString(schema.htmlAttrs),\n    bodyAttrs: propsToString(schema.bodyAttrs)\n  };\n}\n\nasync function renderSSRHead(head) {\n  const beforeRenderCtx = { shouldRender: true };\n  await head.hooks.callHook(\"ssr:beforeRender\", beforeRenderCtx);\n  if (!beforeRenderCtx.shouldRender) {\n    return {\n      headTags: \"\",\n      bodyTags: \"\",\n      bodyTagsOpen: \"\",\n      htmlAttrs: \"\",\n      bodyAttrs: \"\"\n    };\n  }\n  const ctx = { tags: await head.resolveTags() };\n  if (head.resolvedOptions.experimentalHashHydration) {\n    ctx.tags.push({\n      tag: \"meta\",\n      props: {\n        name: \"unhead:ssr\",\n        content: computeHashes(\n          ctx.tags.filter((t) => {\n            const entry = head.headEntries().find((entry2) => entry2._i === t._e);\n            return entry?._m !== \"server\";\n          }).map((tag) => tag._h)\n        )\n      }\n    });\n  }\n  await head.hooks.callHook(\"ssr:render\", ctx);\n  const html = ssrRenderTags(ctx.tags);\n  const renderCtx = { tags: ctx.tags, html };\n  await head.hooks.callHook(\"ssr:rendered\", renderCtx);\n  return renderCtx.html;\n}\n\nexport { encodeInnerHtml, propsToString, renderSSRHead, ssrRenderTags, tagToString };\n"],"names":["propsToString","props","handledAttributes","key","value","attribute","encodeInnerHtml","str","char","tagToString","tag","attrs","openTag","TagsWithInnerContent","SelfClosingTags","content","ssrRenderTags","tags","schema","renderSSRHead","head","beforeRenderCtx","ctx","computeHashes","t","entry","entry2","html","renderCtx"],"mappings":"oFAEA,SAASA,EAAcC,EAAO,CAC5B,MAAMC,EAAoB,CAAA,EAC1B,SAAW,CAACC,EAAKC,CAAK,IAAK,OAAO,QAAQH,CAAK,EAAG,CAChD,GAAIG,IAAU,IAASA,GAAS,KAC9B,SACF,IAAIC,EAAYF,EACZC,IAAU,KACZC,GAAa,KAAK,OAAOD,CAAK,EAAE,QAAQ,KAAM,QAAQ,MACxDF,EAAkB,KAAKG,CAAS,CACjC,CACD,OAAOH,EAAkB,OAAS,EAAI,IAAIA,EAAkB,KAAK,GAAG,IAAM,EAC5E,CAEA,SAASI,EAAgBC,EAAK,CAC5B,OAAOA,EAAI,QAAQ,YAAcC,GAAS,CACxC,OAAQA,EAAI,CACV,IAAK,IACH,MAAO,QACT,IAAK,IACH,MAAO,OACT,IAAK,IACH,MAAO,OACT,IAAK,IACH,MAAO,SACT,IAAK,IACH,MAAO,SACT,IAAK,IACH,MAAO,SACT,QACE,OAAOA,CACV,CACL,CAAG,CACH,CACA,SAASC,EAAYC,EAAK,CACxB,MAAMC,EAAQX,EAAcU,EAAI,KAAK,EAC/BE,EAAU,IAAIF,EAAI,MAAMC,KAC9B,GAAI,CAACE,EAAqB,SAASH,EAAI,GAAG,EACxC,OAAOI,EAAgB,SAASJ,EAAI,GAAG,EAAIE,EAAU,GAAGA,MAAYF,EAAI,OAC1E,IAAIK,EAAU,OAAOL,EAAI,WAAa,EAAE,EACxC,OAAIA,EAAI,cACNK,EAAUT,EAAgB,OAAOI,EAAI,WAAW,CAAC,GAC5CI,EAAgB,SAASJ,EAAI,GAAG,EAAIE,EAAU,GAAGA,IAAUG,MAAYL,EAAI,MACpF,CAEA,SAASM,EAAcC,EAAM,CAC3B,MAAMC,EAAS,CAAE,UAAW,CAAE,EAAE,UAAW,CAAE,EAAE,KAAM,CAAE,KAAM,CAAA,EAAI,UAAW,CAAA,EAAI,SAAU,CAAA,CAAI,CAAA,EAC9F,UAAWR,KAAOO,EAAM,CACtB,GAAIP,EAAI,MAAQ,aAAeA,EAAI,MAAQ,YAAa,CACtDQ,EAAOR,EAAI,KAAO,CAAE,GAAGQ,EAAOR,EAAI,KAAM,GAAGA,EAAI,KAAK,EACpD,QACD,CACDQ,EAAO,KAAKR,EAAI,aAAe,QAAQ,KAAKD,EAAYC,CAAG,CAAC,CAC7D,CACD,MAAO,CACL,SAAUQ,EAAO,KAAK,KAAK,KAAK;AAAA,CAAI,EACpC,SAAUA,EAAO,KAAK,UAAU,KAAK;AAAA,CAAI,EACzC,aAAcA,EAAO,KAAK,SAAS,KAAK;AAAA,CAAI,EAC5C,UAAWlB,EAAckB,EAAO,SAAS,EACzC,UAAWlB,EAAckB,EAAO,SAAS,CAC7C,CACA,CAEA,eAAeC,EAAcC,EAAM,CACjC,MAAMC,EAAkB,CAAE,aAAc,IAExC,GADA,MAAMD,EAAK,MAAM,SAAS,mBAAoBC,CAAe,EACzD,CAACA,EAAgB,aACnB,MAAO,CACL,SAAU,GACV,SAAU,GACV,aAAc,GACd,UAAW,GACX,UAAW,EACjB,EAEE,MAAMC,EAAM,CAAE,KAAM,MAAMF,EAAK,YAAa,CAAA,EACxCA,EAAK,gBAAgB,2BACvBE,EAAI,KAAK,KAAK,CACZ,IAAK,OACL,MAAO,CACL,KAAM,aACN,QAASC,EACPD,EAAI,KAAK,OAAQE,GAAM,CACrB,MAAMC,EAAQL,EAAK,YAAW,EAAG,KAAMM,GAAWA,EAAO,KAAOF,EAAE,EAAE,EACpE,OAAOC,GAAA,YAAAA,EAAO,MAAO,QACtB,CAAA,EAAE,IAAKf,GAAQA,EAAI,EAAE,CACvB,CACF,CACP,CAAK,EAEH,MAAMU,EAAK,MAAM,SAAS,aAAcE,CAAG,EAC3C,MAAMK,EAAOX,EAAcM,EAAI,IAAI,EAC7BM,EAAY,CAAE,KAAMN,EAAI,KAAM,KAAAK,CAAI,EACxC,aAAMP,EAAK,MAAM,SAAS,eAAgBQ,CAAS,EAC5CA,EAAU,IACnB"}